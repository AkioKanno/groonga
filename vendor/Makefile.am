# nginx's Makefile specify 'build' as the default rule.
# This isn't compatible with the 'all' default rule generated by Automake
# So, override the all rule.

if WITH_NGINX
NGINX_DIR = nginx-1.2.1

NGINX_MAKEILE = $(NGINX_DIR)/Makefile
NGINX_MAKEFILE_DEPEND_FILES =			\
	$(NGINX_DIR)/configure			\
	Makefile.am				\
	$(top_builddir)/config.status		\
	$(top_srcdir)/src/nginx-module/config

	(cd .. && \
$(NGINX_MAKEILE): $(NGINX_MAKEFILE_DEPEND_FILES)
	  $(SHELL) "$(abs_top_srcdir)/vendor/nginx/configure" \
	    `./config.status --config`)

all-local: $(NGINX_MAKEILE)
	(cd $(NGINX_DIR) && $(MAKE) build)

install-exec-local: $(NGINX_MAKEILE)
	(cd $(NGINX_DIR) && $(MAKE) install)
endif

EXTRA_DIST = nginx $(NGINX_DIR)
