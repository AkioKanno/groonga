# nginx's Makefile specify 'build' as the default rule.
# This isn't compatible with the 'all' default rule generated by Automake
# So, override the all rule.

if WITH_GROONGA_HTTPD
NGINX_DIR = nginx-1.2.1

NGINX_MAKEILE = $(NGINX_DIR)/Makefile
NGINX_MAKEFILE_DEPEND_FILES =			\
	nginx/configure				\
	Makefile.am				\
	$(top_builddir)/config.status		\
	$(top_srcdir)/src/nginx-module/config

$(NGINX_MAKEILE): $(NGINX_MAKEFILE_DEPEND_FILES)
	(cd nginx && \
	  $(SHELL) "$(abs_top_srcdir)/vendor/nginx/configure" \
	    `../../config.status --config`)

all-local: $(NGINX_MAKEILE)
	(cd $(NGINX_DIR) && $(MAKE) build)

clean-local: $(NGINX_MAKEILE)
	(cd $(NGINX_DIR) && $(MAKE) clean)

install-exec-local: $(NGINX_MAKEILE)
	(cd $(NGINX_DIR) && $(MAKE) install)
endif

EXTRA_DIST = nginx $(NGINX_DIR)
