.. highlightlang:: none

select
======

名前
----

select - テーブルの中から条件にマッチするレコードを検索して出力する

書式
----
::

 select table [match_column [query [filter [scorer [sortby [output_columns
              [offset [limit [drilldown [drilldown_sortby [drilldown_output_columns
              [drilldown_offset [drilldown_limit [output_type]]]]]]]]]]]]]]

説明
----

groonga組込コマンドの一つであるselectについて説明します。組込コマンドは、groonga実行ファイルの引数、標準入力、またはソケット経由でgroongaサーバにリクエストを送信することによって実行します。

selectは、使用しているデータベースのテーブルの中から条件にマッチするレコードを検索して出力します。

引数
----

``table``

  検索対象のテーブルを指定します。

``match_column``

  query引数に指定する検索条件文字列でデフォルトの検索対象となるカラムを指定します。

``query``

  検索条件をquery形式のgrn式文字列によって指定します。

``filter``

  絞り込み条件をscript形式のgrn式文字列によって指定します。

query引数とfilter引数をどちらも指定した場合は、両方の条件を満足するレコードのみがヒットします。どちらも指定しない場合は全件がヒットします。

``scorer``

  検索条件にマッチする全てのレコードに対して適用するgrn式をscript形式で指定します。

  scorerは、検索処理が完了し、ソート処理が実行される前に呼び出されます。従って、各レコードのスコアを操作する式を指定しておけば、検索結果のソート順序をカスタマイズできるようになります。

``sortby``

  ソートキーとなるカラム名のリストを空白(' ')区切りで指定します。一つ目に指定されたカラムの値で各レコードを比較し、一つ目に指定されたカラムの値が一致していた場合は二つ目以降に指定されたカラムの値で順次比較を行い、レコードをソートします。カラム名の前にハイフン('-')を指定すれば、そのカラム値に関して降順でソートします。(デフォルトは昇順)

``output_columns``

  出力するカラム名のリストを空白(' ')区切りで指定します。

  アスタリスク('*')を指定すると、全てのカラムが指定されたものとみなされます。または、script形式のgrn式文字列を指定します。 [#]_ (デフォルトは、'_id \*')

``offset``

  検索条件にマッチしたレコードのうち、出力対象となる最初のレコードの番号を0ベースで指定します。(デフォルト値は0) offsetに負の値を指定した場合は、ヒットした件数 + offset によって算出される値が指定されたものとみなされます。

``limit``

  検索条件にマッチしたレコードのうち、出力を行うレコードの件数を指定します。実際には、offset + limit がヒットした件数を超えない範囲でレコードが出力されます。

``drilldown``

  グループ化のキーとなるカラム名のリストを空白(' ')区切りで指定します。検索条件にマッチした各レコードを出力したのちに、drilldownに指定されたカラムの値が同一であるレコードをとりまとめて、それぞれについて結果レコードを出力します。

``drilldown_sortby``

  drilldown条件に指定されたカラムの値毎にとりまとめられたレコードについて、ソートキーとなるカラム名のリストを空白(' ')区切りで指定します。sortbyパラメータと同様に昇降順を指定できます。

``drilldown_output_columns``

  drilldown条件に指定されたカラムの値毎にとりまとめられたレコードについて、出力するカラム名のリストを空白(' ')区切りで指定します。

``drilldown_offset``

  drilldown条件に指定されたカラムの値毎にとりまとめられたレコードについて、出力対象となる最初のレコードの番号を0ベースで指定します。

``drilldown_limit``

  drilldown条件に指定されたカラムの値毎にとりまとめられたレコードについて、出力を行うレコードの件数を指定します。

``output_type``

  出力形式を、json,tsv,xmlのいずれかで指定します。 [#]_

返値
----

リターンコード

  grn_rcに対応する数値が返されます。0(GRN_SUCCESS)以外の場合は、続いてエラー内容を示す文字列が返されます。

検索結果
  drilldown条件が実行される前の検索結果が以下のように出力されます。

  件数
    ヒット件数が出力されます。

  出力カラム名リスト
    output_columnsに指定された条件に従って、対象となるカラム名のリストが出力されます。

  各レコードの値
    output_columns, offset, limitによって指定された条件に従って各レコードの値が出力されます。

drilldown結果
  drilldown条件に指定されたカラムの数分だけ、drilldown処理の結果が以下のように出力されます。

  件数
    drilldown条件に指定されたカラムの値の異なり数が出力されます。

  出力カラム名リスト
    drilldown_output_columnsに指定された条件に従って、対象となるカラム名のリストが出力されます。

  各レコードの値
    drilldown_output_columns, drilldown_offset, drilldown_limitによって指定された条件に従って各レコードの値が出力されます。

例
--

テーブルEntryの全レコード・全カラムの値を出力します。::

 select Entry --output_type json

 [[0],[[2],["_id","_key","body"],[1,"abandon","放棄する"],[2,"abbreviate","短縮する"]]]

 select Entry --output_type xml

 <SEGMENTS><SEGMENT><RESULTPAGE><RESULTSET OFFSET="0" LIMIT="10" NHITS="2"><HIT NO="1"><FIELD NAME="_id">1</FIELD><FIELD NAME="_key">abandon</FIELD><FIELD NAME="body">放棄する</FIELD></HIT><HIT NO="2"><FIELD NAME="_id">2</FIELD><FIELD NAME="_key">abbreviate</FIELD><FIELD NAME="body">短縮する</FIELD></HIT></RESULTSET></RESULTPAGE></SEGMENT></SEGMENTS>

関連項目
--------

:doc:`expr`

.. rubric:: 脚注

.. [#] output_columnsでのgrn式指定はv1.0でサポートされます。
.. [#] tsv,xml出力はv1.0でサポートされます。
