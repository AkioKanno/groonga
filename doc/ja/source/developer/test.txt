.. highlightlang:: none

テスト方法
===========

テスト環境の構築
----------------

Cutterのインストール
^^^^^^^^^^^^^^^^^^^^

groongaは、テストのフレームワークとしてCutterを用いています。

詳細はhttp://cutter.sourceforge.net/をごらんください。

Cutterをインストールするためには、GLib2.0とintltoolsの新しめの版が必要です。DebianやUbuntuでは、以下のようにしてインストールできます。::

 # aptitude install libglib2.0-dev intltools

lcovのインストール
^^^^^^^^^^^^^^^^^^

カバレッジ情報を計測するためには、lcov 1.6以上が必要です。以下のようにしてインストールできます。::

 # aptitude install libglib2.0-dev intltools

test-unitのインストール
^^^^^^^^^^^^^^^^^^^^^^^

Rubyで書かれたテスト（主にHTTPのテスト）を実行するためには、test-unitの新しめの版が必要です。以下のようにしてインストールできます。::

 # aptitude install rubygems
 # gem install test-unit

libmemcachedのインストール
^^^^^^^^^^^^^^^^^^^^^^^^^^

memcachedのバイナリプロトコルのテストを動作させるためには、
libmemcachedの導入が必要です。

テストの動作
------------

groongaのトップディレクトリで、以下のコマンドを実行します。::

 make check

カバレッジ情報
--------------

groongaのトップディレクトリで、以下のコマンドを実行します。::

 make coverage

すると、coverageディレクトリ以下に、カバレッジ情報が入ったhtmlが出力されます。

カバレッジには、Lines/Functions/Branchesの3つの対象があります。それぞれ、行／関数／分岐に対応します。Functionsがもっとも重要な対象です。すべての関数がテストされるようになっていることを心がけてください。

テストがカバーしていない部分の編集は慎重に行ってください。また、テストがカバーしている部分を増やすことも重要です。

様々なテスト
------------

テストは、test/unitディレクトリにおいて、./run-test.shを実行することによっても行えます。run-test.shはいくつかのオプションをとります。詳細は、./run-test.sh --helpを実行しヘルプをご覧ください。

特定のテスト関数のみテストする
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

特定のテスト関数(Cutterではテストと呼ぶ)のみをテストすることができます。

実行例::

 % ./run-test.sh -n test_text_otoj

特定のテストファイルのみテストする
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

特定のテストファイル(Cutterではテストケースと呼ぶ)のみテストすることができます。

実行例::

 % ./run-test.sh -t test_string

不正メモリアクセス・メモリリーク検出
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

環境変数CUTTER_CHECK_LEAKをyesと設定すると、valgrindを用いて不正メモリアクセスやメモリリークを検出しつつ、テストを動作させることができます。

run-test.shのみならず、make checkでも利用可能です。

実行例::

 % CUTTER_CHECK_LEAK=yes make check

デバッガ上でのテスト実行
^^^^^^^^^^^^^^^^^^^^^^^^

環境変数CUTTER_DEBUGをyesと設定すると、テストが実行できる環境が整ったgdbが実行されます。gdb上でrunを行うと、テストの実行が開始されます。

run-test.shのみならず、make checkでも利用可能です。

実行例::

 % CUTTER_DEBUG=yes make check
