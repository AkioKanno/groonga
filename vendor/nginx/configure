#!/bin/sh

set -e

nginx_version=1.2.1

export GROONGA_HTTPD_IN_TREE=yes
. "../../groonga-httpd-conf.sh"

echo "$0"
source_directory="`dirname \"$0\"`"
absolute_source_directory="`cd \"$source_directory\"/../.. && pwd`"

if [ "$absolute_source_directory" != "`pwd`" ]; then
    rm -rf vendor/nginx-${nginx_version}
    cp -rp "$absolute_source_directory/vendor/nginx-${nginx_version}" vendor/
fi

cd "../nginx-${nginx_version}"

./configure \
  --prefix="${GROONGA_HTTPD_PREFIX}" \
  --sbin-path="${GROONGA_HTTPD_BIN_PATH}" \
  --conf-path="${GROONGA_HTTPD_CONF_PATH}" \
  --error-log-path="${GROONGA_HTTPD_ERROR_LOG_PATH}" \
  --http-log-path="${GROONGA_HTTPD_HTTP_LOG_PATH}" \
  --add-module="${GROONGA_HTTPD_MODULE_PATH}" \
  --without-http_rewrite_module
